# TSP-vs-Graphs
TSP-vs-Graphs is a repository for studying relations between the traveling salesman problem (TSP) and proximity graphs.

The TSP tour, TSP path, and bitonic TSP tour are implemented and studied. Proximity graphs of interest include the k-nearest neighbor graph (k-NNG), minimum spanning tree (MST), Gabriel graph, Urquhart graph, and order-k Delaunay (primarily k=0, 1, 2).

## Contents
1. [Setup](#setup)
2. [Simulation](#simulation)
3. [Graphical User Interface](#graphical-user-interface)
4. [Example Graphs](#example-graphs)
5. [TSP-NNG Intersection Algorithm](#tsp-nng-intersection-algorithm)

# Setup
Clone and `cd` into this repository:
```
git clone https://github.com/samvanderpoel/TSP-vs-Graphs
cd TSP-vs-Graphs
```
Create a Conda environment (see [Anaconda](https://www.anaconda.com)) with the necessary libraries:
```
conda create --name tsp python=3.7.3 pip
conda activate tsp
conda install -c conda-forge graph-tool
pip install -r requirements.txt
```
Next, set up [PyConcorde](https://github.com/jvkersch/pyconcorde):
```
git clone https://github.com/jvkersch/pyconcorde
cd pyconcorde
pip install -e .
cd ..
```
[GNU Parallel](https://www.gnu.org/software/parallel/) is optionally used in the simulation code (see [Simulation Parameters](#simulation-parameters)).

# Simulation
Simulation parameters are specified in scripts having the format of sim/simulate.sh, and simulations are executed with `bash sim/simulate.sh`. Several jobs may be run concurrently as long as they have distinct `jobname`s.

The results of a job called "myjob" are stored in results/myjob, and they are organized by point cloud distributions (e.g. uniform on [0,1]x[0,1], bivariate normal, etc.). Graph comparison results are stored in files called 'data.txt', simulation meta-data are stored in files called 'meta.txt', and simulation compute times are stored in files called 'compute-times.txt', all of which are generated by sim/main.py.

In simulation and plotting scripts, graphs have unique IDs to track comparisons and organize results. Our conventions are described at the top of sim/main.py.

## Simulation Parameters
- `jobname` is the unique name identifying the current simulation job
- `minpts` and `maxpts` delineate the min and max point cloud sizes to simulate
- `interval` specifies the spacing between consecutive point cloud sizes
- `numrunsper` specifies how many point clouds to simulate per point cloud size
- `batch` specifies the number of point clouds to simulate concurrently
- `cloudtypes` lists the point cloud samplying types to sample from. The available options are listed in sim/simulate.sh, and they are implemented in sim/cloud_funcs.py.
- `tour`, `path`, and `bito` list the specific edgewise graph comparisons to make. Graphs are specified by major_id and minor_id, as described at the top of sim/main.py. When `tour`, `path`, and `bito` are concatenated, the result must be formatted as a python dictionary, as this is read by sim/main.py.
- `anoms` specifies which 'anomalies' to check for and record (if found); must be formatted as a Python dictionary. For example, "{'tour_6del':'<1','path_mst':'==1'}" checks for point clouds whose TSP tours are not a subset of the order-6 Delaunay; and point clouds whose TSP paths are equal to the MST.
- `par` specifies whether point cloud _types_ should be simulated in parallel (requires GNU's `parallel`)
- `concurrently` specifies number of point cloud types to simulate concurrently (if `par` is true)

## Test Program
A test simulation can be executed with `bash sim/test.sh`, the results of which will be stored in results/test/uniform-sqr-results.

## Print a Summary of Simulation Results
Existing data from job "myjob" are printed to standard output with
```
python sim/report_existing_data.py --jobname myjob
```
The optional flag ``--all`` verbosely prints data for each point cloud size, and the flag ``--export`` writes statistics to a csv file:
```
python sim/report_existing_data.py --jobname myjob --all --export
```

## Plot Simulation Results
Plotting of simulation results is implemented in sim/plot_simul_data.py. For example, to plot all results from job "myjob" and point cloud distribution "uniform-sqr" (uniform on [0,1]x[0,1]), run
```
python sim/plot_simul_data.py --jobname myjob --cloudtype uniform-sqr --comps \"all\" --subdir ""
```
The results are stored in results/myjob/uniform-sqr/plots. The `--subdir` argument indicates which (if any) subdirectory of results/myjob/uniform-sqr/plots the plots should be stored in. The script sim/gen_plots.sh shows how to generate many plots at once, and with more precise control over the data that are plotted.

## Graph comparison and anomaly detection
Large-scale edgewise graph comparison is the primary purpose of the simulation API, but simulations can additionally be used to test graphs for other properties. The 'compare' function in sim/utils.py can be used to detect whether graphs satisfy a certain criterion and, if so, save the corresponding point cloud to a yaml file.

Anomalies to search for (and record) may be specified in the `anoms` dictionary (see [Simulation Parameters](#simulation-parameters)), but importantly, specific criteria may be directly tested in the 'compare' function in sim/utils.py. For example, one may wish to test whether it is possible for the TSP tour to properly intersect the MST (one would test this when `comp=tour_mst`).

# Graphical User Interface
## Basic interactive mode
A blank GUI is launched with
```
python plot/plot.py --interactive
```
Points may be double-clicked directly onto the canvas. To compute graphs for a point cloud on the canvas, the current window must be the GUI canvas, and press `i`. You will see a set of options appear in the terminal; type and enter the string associated with the graph you would like to compute.

To clear all edges on the current point cloud, press `x`; to clear all points and edges, press `c`.

Points clouds may be sampled from various distributions by selecting the canvas and pressing one of the following keys: 'u' for uniform, 'm' for multimodal normal, or 'o' for concentric circles.

## Plotting a point cloud from a YAML file
To plot, for example, the point cloud stored in example-graphs/nng/tour-nng-ce-16.yaml, run:
```
python plot/plot.py --file example-graphs/nng/tour-nng-ce-16.yaml
```

# Example Graphs
Coordinates are provided for salient point clouds.
## Examples related to the order-k Delaunay

# TSP-NNG Intersection Algorithm
The main TSP-NNG algorithm is described in tspnng/tspnng-pseudocode.pdf and implemented in tspnng/tournng.py. The script tspnng/runtournng.sh shows how to execute the algorithm for specific values of n and user-specified amounts of parallelism (provided by GNU parallel and Python multiprocessing).
